<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#1a1a2e">
  <link rel="icon" type="image/png" href="/icon-192.png">
  <link rel="manifest" href="/manifest.json">
  <title>Receipt Upload</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(145deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%); min-height: 100vh; min-height: 100dvh; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; color: #fff; }
    .container { width: 100%; max-width: 400px; text-align: center; }
    h1 { font-size: 1.5rem; font-weight: 600; margin-bottom: 8px; }
    .subtitle { font-size: 0.875rem; color: rgba(255,255,255,0.6); margin-bottom: 40px; }
    .preview-area { width: 100%; aspect-ratio: 4/3; background: rgba(255,255,255,0.05); border: 2px dashed rgba(255,255,255,0.2); border-radius: 16px; display: flex; align-items: center; justify-content: center; margin-bottom: 24px; overflow: hidden; position: relative; }
    .preview-area.has-image { border-style: solid; border-color: rgba(255,255,255,0.3); }
    .preview-area img { width: 100%; height: 100%; object-fit: cover; }
    .placeholder { display: flex; flex-direction: column; align-items: center; gap: 12px; color: rgba(255,255,255,0.4); }
    .placeholder svg { width: 48px; height: 48px; opacity: 0.5; }
    .btn { width: 100%; padding: 18px 24px; border: none; border-radius: 12px; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: all 0.2s ease; display: flex; align-items: center; justify-content: center; gap: 10px; }
    .btn-capture { background: #fff; color: #1a1a2e; margin-bottom: 12px; }
    .btn-capture:active { transform: scale(0.98); background: #f0f0f0; }
    .btn-send { background: #4ade80; color: #064e3b; }
    .btn-send:disabled { background: rgba(255,255,255,0.1); color: rgba(255,255,255,0.3); cursor: not-allowed; }
    .btn-send:not(:disabled):active { transform: scale(0.98); background: #22c55e; }
    .btn svg { width: 24px; height: 24px; }
    input[type="file"] { display: none; }
    .status { margin-top: 20px; padding: 16px; border-radius: 12px; font-size: 0.95rem; display: none; }
    .status.success { display: block; background: rgba(74, 222, 128, 0.15); color: #4ade80; }
    .status.error { display: block; background: rgba(248, 113, 113, 0.15); color: #f87171; }
    .status.sending { display: block; background: rgba(96, 165, 250, 0.15); color: #60a5fa; }
    .clear-btn { position: absolute; top: 10px; right: 10px; width: 32px; height: 32px; border-radius: 50%; background: rgba(0,0,0,0.6); border: none; color: #fff; font-size: 18px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Receipt Upload</h1>
    <p class="subtitle">Take a photo and send to QuickBooks</p>
    <div class="preview-area" id="previewArea">
      <div class="placeholder" id="placeholder">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>
        <span>No receipt selected</span>
      </div>
      <img id="preview" style="display: none;">
      <button class="clear-btn" id="clearBtn" style="display: none;">×</button>
    </div>
    <input type="file" id="fileInput" accept="image/jpeg,image/jpg,image/png" capture="environment">
    <button class="btn btn-capture" id="captureBtn">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
      Take Photo
    </button>
    <button class="btn btn-send" id="sendBtn" disabled>
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" /></svg>
      Send Receipt
    </button>
    <div class="status" id="status"></div>
  </div>
  <script>
    const fileInput = document.getElementById('fileInput');
    const captureBtn = document.getElementById('captureBtn');
    const sendBtn = document.getElementById('sendBtn');
    const preview = document.getElementById('preview');
    const previewArea = document.getElementById('previewArea');
    const placeholder = document.getElementById('placeholder');
    const clearBtn = document.getElementById('clearBtn');
    const status = document.getElementById('status');
    let selectedFile = null;

    captureBtn.addEventListener('click', function() {
      fileInput.click();
    });

    fileInput.addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        selectedFile = file;
        const reader = new FileReader();
        reader.onload = function(e) {
          preview.src = e.target.result;
          preview.style.display = 'block';
          placeholder.style.display = 'none';
          clearBtn.style.display = 'flex';
          previewArea.classList.add('has-image');
          sendBtn.disabled = false;
          status.className = 'status';
        };
        reader.readAsDataURL(file);
      }
    });

    clearBtn.addEventListener('click', function() {
      selectedFile = null;
      fileInput.value = '';
      preview.style.display = 'none';
      placeholder.style.display = 'flex';
      clearBtn.style.display = 'none';
      previewArea.classList.remove('has-image');
      sendBtn.disabled = true;
      status.className = 'status';
    });

    sendBtn.addEventListener('click', async function() {
      if (!selectedFile) return;
      sendBtn.disabled = true;
      status.className = 'status sending';
      status.textContent = 'Sending...';
      const formData = new FormData();
      formData.append('receipt', selectedFile);
      try {
        const response = await fetch('/upload', { method: 'POST', body: formData });
        const result = await response.json();
        if (response.ok) {
          status.className = 'status success';
          status.textContent = '✓ Receipt sent successfully!';
          setTimeout(function() { clearBtn.click(); }, 2000);
        } else {
          throw new Error(result.error || 'Upload failed');
        }
      } catch (error) {
        status.className = 'status error';
        status.textContent = '✕ ' + error.message;
        sendBtn.disabled = false;
      }
    });
  </script>
</body>
</html>
